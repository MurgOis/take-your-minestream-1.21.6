# Система сообщений - Архитектура

После рефакторинга система сообщений была разбита на отдельные компоненты с четким разделением ответственности.

## Компоненты

### 1. Message

**Файл:** `Message.java`
**Ответственность:** Модель данных для отображаемого сообщения

- Хранит текст, позицию, время создания и счетчик замороженных тиков
- Предоставляет метод для вычисления эффективного возраста с учетом заморозки

### 2. MessagePosition

**Файл:** `MessagePosition.java`
**Ответственность:** Генерация позиций для сообщений

- Создает случайные позиции вокруг игрока
- Настраивает радиус и высоту появления сообщений

### 3. MessageViewDetector

**Файл:** `MessageViewDetector.java`
**Ответственность:** Определение направления взгляда игрока

- Проверяет, смотрит ли игрок на сообщение
- Учитывает угол обзора и максимальное расстояние

### 4. MessageQueue

**Файл:** `MessageQueue.java`
**Ответственность:** Управление очередью сообщений

- Хранит сообщения, ожидающие отображения
- Контролирует минимальный интервал между спавном сообщений

### 5. MessageLifecycleManager

**Файл:** `MessageLifecycleManager.java`
**Ответственность:** Управление жизненным циклом сообщений

- Обновляет состояние активных сообщений
- Управляет заморозкой при взгляде игрока
- Удаляет устаревшие сообщения

### 6. MessageSpawner

**Файл:** `MessageSpawner.java`
**Ответственность:** Координация спавна новых сообщений

- Обрабатывает тики клиента
- Извлекает сообщения из очереди и создает новые объекты Message
- Координирует работу между очередью и менеджером жизненного цикла

### 7. MessageRenderer

**Файл:** `MessageRenderer.java`
**Ответственность:** Рендеринг сообщений в мире

- Отображает активные сообщения в 3D пространстве
- Управляет прозрачностью и анимацией исчезновения
- Обрабатывает перенос строк и центрирование текста

### 8. MessageSystemFactory

**Файл:** `MessageSystemFactory.java`
**Ответственность:** Инициализация системы сообщений

- Создает и настраивает все компоненты
- Предоставляет простой интерфейс для запуска системы

## Преимущества новой архитектуры

1. **Разделение ответственности:** Каждый класс имеет четко определенную роль
2. **Тестируемость:** Компоненты можно тестировать независимо
3. **Расширяемость:** Легко добавлять новые функции (например, новые типы анимаций)
4. **Читаемость:** Код стал более понятным и структурированным
5. **Переиспользование:** Компоненты можно использовать в других частях мода

## Использование

```java
// Создание системы через фабрику
MessageSpawner messageSpawner = MessageSystemFactory.createMessageSystem();

// Добавление сообщения
messageSpawner.setCurrentMessage("Привет, мир!");

// Остановка системы
messageSpawner.setCurrentMessage("");
```

## Конфигурация

Все настройки находятся в `ModConfig.java`:

- `MESSAGE_LIFETIME_TICKS` - время жизни сообщения
- `MESSAGE_FADEOUT_TICKS` - время плавного исчезновения
- `ENABLE_FREEZING_ON_VIEW` - включение заморозки при взгляде
- `VIEW_ANGLE_DEGREES` - угол обзора для заморозки
- `MAX_FREEZE_DISTANCE` - максимальное расстояние для заморозки
